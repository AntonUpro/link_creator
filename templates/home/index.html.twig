<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoLink - Сокращение ссылок</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
<div class="min-h-screen flex flex-col items-center justify-center p-4">
    <!-- Заголовок -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">GoLink</h1>
        <p class="text-lg text-gray-600">Самый быстрый и универсальный сокращатель ссылок</p>
        <p class="text-gray-500">Делитесь и отслеживайте свои ссылки с легкостью!</p>
    </div>

    <!-- Форма -->
    <div class="w-full max-w-2xl bg-white rounded-xl shadow-lg p-6 mb-8">
        <form id="shortenForm" class="space-y-4">
            <div class="flex flex-col md:flex-row gap-4">
                <input
                    type="url"
                    id="longUrl"
                    placeholder="Вставьте длинную ссылку здесь..."
                    required
                    class="flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                >
                <button
                    type="submit"
                    id="shortenBtn"
                    class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition duration-200"
                >
                    <i class="fas fa-link mr-2"></i>Сократить ссылку
                </button>
            </div>

            <!-- Кастомный alias (опционально) -->
            <div class="flex items-center gap-2">
                <span class="text-gray-600">{{ app.request.getSchemeAndHttpHost() }}/</span>
                <input
                    type="text"
                    id="customAlias"
                    placeholder="желаемый-псевдоним (опционально)"
                    class="flex-grow px-3 py-2 border border-gray-300 rounded"
                    pattern="[A-Za-z0-9_-]+"
                >
            </div>
        </form>

        <!-- Результат (скрыт по умолчанию) -->
        <div id="resultContainer" class="mt-6 hidden">
            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <h3 class="font-medium text-green-800 mb-2">Ваша короткая ссылка готова!</h3>

                <div class="flex flex-col md:flex-row items-center gap-4">
                    <!-- Короткая ссылка -->
                    <div class="flex-grow">
                        <div class="flex items-center gap-2">
                            <input
                                type="text"
                                id="shortUrlDisplay"
                                readonly
                                class="flex-grow px-3 py-2 bg-white border border-gray-300 rounded font-mono"
                            >
                            <button
                                onclick="copyToClipboard()"
                                class="px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded transition"
                            >
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <p class="text-sm text-gray-500 mt-1">Кликните для копирования</p>
                    </div>

                    <!-- QR код -->
                    <div class="text-center">
                        <div id="qrCodeContainer" class="mb-2"></div>
                        <button
                            onclick="downloadQRCode()"
                            class="px-4 py-2 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200"
                        >
                            <i class="fas fa-download mr-1"></i>Скачать QR
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Примеры -->
    <div class="w-full max-w-2xl bg-white rounded-xl shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Пример</h2>
        <div class="space-y-2 font-mono text-sm">
            <div class="text-gray-600">Оригинальная ссылка:</div>
            <div class="text-blue-600">https://github.com/ebomobile/dsdata</div>
            <div class="text-gray-600">Сокращенная:</div>
            <div class="text-green-600">{{ app.request.getSchemeAndHttpHost() }}/pu2Ee</div>
        </div>
    </div>
</div>

<script>
    document.getElementById('shortenForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const longUrl = document.getElementById('longUrl').value;
        const customAlias = document.getElementById('customAlias').value;
        const btn = document.getElementById('shortenBtn');

        // Показываем загрузку
        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Сокращаем...';
        btn.disabled = true;

        try {
            const response = await fetch('/shorten', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    url: longUrl,
                    customAlias: customAlias || null
                })
            });

            const data = await response.json();

            if (data.success) {
                // Показываем результат
                document.getElementById('shortUrlDisplay').value = data.shortUrl;

                // Генерируем QR код (используем Google Charts API для простоты)
                const qrUrl = data.qrCode.startsWith('http')
                    ? data.qrCode
                    : window.location.origin + data.qrCode;
                document.getElementById('qrCodeContainer').innerHTML = `<img src="${qrUrl}" alt="QR Code" class="mx-auto">`;

                // Показываем контейнер с результатом
                document.getElementById('resultContainer').classList.remove('hidden');
            } else {
                alert('Ошибка: ' + data.error);
            }
        } catch (error) {
            alert('Произошла ошибка при сокращении ссылки');
            console.error(error);
        } finally {
            btn.innerHTML = '<i class="fas fa-link mr-2"></i>Сократить ссылку';
            btn.disabled = false;
        }
    });

    function copyToClipboard() {
        const input = document.getElementById('shortUrlDisplay');
        input.select();
        document.execCommand('copy');
        alert('Ссылка скопирована в буфер обмена!');
    }

    function downloadQRCode() {
        const qrImg = document.querySelector('#qrCodeContainer img');
        if (qrImg) {
            const link = document.createElement('a');
            link.href = qrImg.src;
            link.download = 'qrcode.png';
            link.click();
        }
    }
</script>
</body>
</html>
